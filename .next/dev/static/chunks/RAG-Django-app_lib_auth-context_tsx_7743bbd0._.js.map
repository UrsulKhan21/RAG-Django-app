{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abdur/Downloads/django-project-with-google-auth/RAG-Django-app/lib/auth-context.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from \"react\"\r\n\r\ninterface User {\r\n  id: string\r\n  email: string\r\n  name: string\r\n  picture: string\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null\r\n  isLoading: boolean\r\n  isAuthenticated: boolean\r\n  login: () => void\r\n  logout: () => void\r\n  backendUrl: string\r\n  setBackendUrl: (url: string) => void\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nconst BACKEND_URL_KEY = \"rag_backend_url\"\r\nconst DEFAULT_BACKEND = \"http://localhost:8000\"\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [backendUrl, setBackendUrlState] = useState(DEFAULT_BACKEND)\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(BACKEND_URL_KEY)\r\n    if (stored) setBackendUrlState(stored)\r\n  }, [])\r\n\r\n  const setBackendUrl = useCallback((url: string) => {\r\n    setBackendUrlState(url)\r\n    localStorage.setItem(BACKEND_URL_KEY, url)\r\n  }, [])\r\n\r\n  // Check auth status on mount\r\n  useEffect(() => {\r\n    checkAuth()\r\n  }, [backendUrl])\r\n\r\n  const checkAuth = async () => {\r\n    try {\r\n      const res = await fetch(`${backendUrl}/api/auth/user/`, {\r\n        credentials: \"include\",\r\n      })\r\n      if (res.ok) {\r\n        const data = await res.json()\r\n        setUser(data)\r\n      } else {\r\n        setUser(null)\r\n      }\r\n    } catch {\r\n      setUser(null)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const login = () => {\r\n    window.location.href = `${backendUrl}/api/auth/google/login/`\r\n  }\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await fetch(`${backendUrl}/api/auth/logout/`, {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n      })\r\n    } catch {\r\n      // ignore\r\n    }\r\n    setUser(null)\r\n    window.location.href = \"/\"\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        isLoading,\r\n        isAuthenticated: !!user,\r\n        login,\r\n        logout,\r\n        backendUrl,\r\n        setBackendUrl,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext)\r\n  if (!context) throw new Error(\"useAuth must be used within AuthProvider\")\r\n  return context\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAqBA,MAAM,4BAAc,IAAA,sMAAa,EAA8B;AAE/D,MAAM,kBAAkB;AACxB,MAAM,kBAAkB;AAEjB,SAAS,aAAa,EAAE,QAAQ,EAAiC;;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iMAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iMAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,mBAAmB,GAAG,IAAA,iMAAQ,EAAC;IAElD,IAAA,kMAAS;kCAAC;YACR,MAAM,SAAS,aAAa,OAAO,CAAC;YACpC,IAAI,QAAQ,mBAAmB;QACjC;iCAAG,EAAE;IAEL,MAAM,gBAAgB,IAAA,oMAAW;mDAAC,CAAC;YACjC,mBAAmB;YACnB,aAAa,OAAO,CAAC,iBAAiB;QACxC;kDAAG,EAAE;IAEL,6BAA6B;IAC7B,IAAA,kMAAS;kCAAC;YACR;QACF;iCAAG;QAAC;KAAW;IAEf,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,eAAe,CAAC,EAAE;gBACtD,aAAa;YACf;YACA,IAAI,IAAI,EAAE,EAAE;gBACV,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,QAAQ;YACV,OAAO;gBACL,QAAQ;YACV;QACF,EAAE,OAAM;YACN,QAAQ;QACV,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,QAAQ;QACZ,OAAO,QAAQ,CAAC,IAAI,GAAG,GAAG,WAAW,uBAAuB,CAAC;IAC/D;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,MAAM,GAAG,WAAW,iBAAiB,CAAC,EAAE;gBAC5C,QAAQ;gBACR,aAAa;YACf;QACF,EAAE,OAAM;QACN,SAAS;QACX;QACA,QAAQ;QACR,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,qBACE,qNAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA,iBAAiB,CAAC,CAAC;YACnB;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;GAtEgB;KAAA;AAwET,SAAS;;IACd,MAAM,UAAU,IAAA,mMAAU,EAAC;IAC3B,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;IAC9B,OAAO;AACT;IAJgB"}}]
}